#!/bin/bash

# prevent duplicate listeners
if [[ "$(ps -fp $(pidof bash 2>/dev/null) | grep -c "/etc/freedom-node/include/listener")" -eq "0" ]] &>/dev/null; then

  DEVICE="/dev/input/event0" # use the real event device!

  evtest "$DEVICE" | while read -r LINE; do
    if [[ "$LINE" == *"ABS_X"* ]]; then
      x=$(echo "$LINE" | grep -oP 'value \K[0-9]+')
    elif [[ "$LINE" == *"ABS_Y"* ]]; then
      y=$(echo "$LINE" | grep -oP 'value \K[0-9]+')
      echo "$x $y" >/tmp/touchcoords
      bash /etc/freedom-node/include/touch
    fi
  done
fi

# END
